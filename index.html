<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>The Pirate Port</title>
        <link rel="icon" href="../../favicon.ico">
        <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

        <style type="text/css">
/*            fix bootstrap responsive tables for firefox*/
            @-moz-document url-prefix() {
              fieldset { display: table-cell; }
            }

            .tbl_icon {
                height:20px;
            }
        </style>

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script type="text/javascript">
            function sendToTransmission (magnetLink) {
                var url = '/download_transmission?link=' + encodeURIComponent(magnetLink);
                $.get(url, null);
            }

            function performSearch() {
                var searchTerm = $('#search_term').val();
                var category = $('#category_select').val();

                var table = $('#results_tbl');
                var table_data = $('#results_tbl tbody');
                $(table_data).remove();
                
                table_data = $('<tbody>');
                $(table).append(table_data);

                $.getJSON( "/search", { term:searchTerm, category:category}, function( data ) {             
                  $.each( data, function( key, val ) {
                     $(table_data).append(
                        $('<tr>').append(
                            $('<td>').text(val.category.name),
                            $('<td>').text(val.subcategory.name),
                            $('<td>').text(val.name),
                            $('<td>').text(val.uploadDate),
                            $('<td>').text(val.size).css('text-align', 'right'),
                            $('<td>').append($('<span>').attr('class', 'glyphicon glyphicon-arrow-up').text(val.seeders)),
                            $('<td>').append($('<span>').attr('class', 'glyphicon glyphicon-arrow-down').text(val.leechers)),

                            $('<td>').append($('<a>').attr('href', val.link).append($('<img>').attr('alt', 'More Info').attr('src', '/images/link.png').attr('class', 'tbl_icon'))),

                            $('<td>').append($('<a>').attr('href', val.magnetLink).append($('<img>').attr('alt', 'Download Magnet Link').attr('src', '/images/magnet.png').attr('class', 'tbl_icon'))),


                            $('<td>').append($('<a>').attr('href', '#').click(function() { sendToTransmission(val.magnetLink) }).append($('<img>').attr('alt', 'Send To Transmission').attr('src', '/images/transmission.png').attr('class', 'tbl_icon')))   

                            // $('<td>').append($('<a>').attr('href', val.torrentLink).append($('<img>').attr('alt', 'Download Torrent File').attr('src', 'http://www.apkdad.com/wp-content/uploads/2012/12/BitTorrent-Beta-Torrent-App-Icon1.png').attr('class', 'tbl_icon'))),                            
                        )
                     );
                  });
                });
            }

            $(function() {

            });
        </script>
    </head>

    <body>
        <div class="container">
<div class="page-header">
  <h1>The Pirate Port</h1>
</div>
            <form onsubmit="performSearch();return false;" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" name="search_term" id="search_term" placeholder="Search" name="q">
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>

                <select style="width:50%" class="form-control" id="category_select" name="category">
                    <option value="0" selected="selected">All</option>
                    <optgroup label="Audio">
                        <option value="101">Music</option>
                        <option value="102">Audio books</option>
                        <option value="103">Sound clips</option>
                        <option value="104">FLAC</option>
                        <option value="199">Other</option>
                    </optgroup>
                    <optgroup label="Video">
                        <option value="201">Movies</option>
                        <option value="202">Movies DVDR</option>
                        <option value="203">Music videos</option>
                        <option value="204">Movie clips</option>
                        <option value="205">TV shows</option>
                        <option value="206">Handheld</option>
                        <option value="207">HD - Movies</option>
                        <option value="208">HD - TV shows</option>
                        <option value="209">3D</option>
                        <option value="299">Other</option>
                    </optgroup>
                    <optgroup label="Applications">
                        <option value="301">Windows</option>
                        <option value="302">Mac</option>
                        <option value="303">UNIX</option>
                        <option value="304">Handheld</option>
                        <option value="305">IOS (iPad/iPhone)</option>
                        <option value="306">Android</option>
                        <option value="399">Other OS</option>
                    </optgroup>
                    <optgroup label="Games">
                        <option value="401">PC</option>
                        <option value="402">Mac</option>
                        <option value="403">PSx</option>
                        <option value="404">XBOX360</option>
                        <option value="405">Wii</option>
                        <option value="406">Handheld</option>
                        <option value="407">IOS (iPad/iPhone)</option>
                        <option value="408">Android</option>
                        <option value="499">Other</option>
                    </optgroup>
                    <optgroup label="Porn">
                        <option value="501">Movies</option>
                        <option value="502">Movies DVDR</option>
                        <option value="503">Pictures</option>
                        <option value="504">Games</option>
                        <option value="505">HD - Movies</option>
                        <option value="506">Movie clips</option>
                        <option value="599">Other</option>
                    </optgroup>
                    <optgroup label="Other">
                        <option value="601">E-books</option>
                        <option value="602">Comics</option>
                        <option value="603">Pictures</option>
                        <option value="604">Covers</option>
                        <option value="605">Physibles</option>
                        <option value="699">Other</option>
                    </optgroup>
                </select>           

            </form>

            <div class="table-responsive">
                <table class="table table-striped table-condensed" id="results_tbl">
                    <thead>
                        <tr>
                            <th colspan="2">Category</th>
                            <th>Name</th>
                            <th>Uploaded</th>
                            <th>Size</th>
                            <th colspan="2">Ratio</th>
                            <th colspan="3">Options</th>
                        </tr>
                    </thead>
                    <tbody />
                </table>
            </div>
    </div>
    </body>
</html>